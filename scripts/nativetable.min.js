var Nativetable=function(){"use strict";function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),e=function(){function e(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.sources,o=void 0===a?[]:a,r=i.filters,s=void 0===r?{}:r,d=i.columns,l=void 0===d?[]:d,h=i.pagination;h=void 0===h?{}:h;var u=h.maxLength,c=void 0===u?-1:u,p=i.sorting,f=void 0!==p&&p;if(t(this,e),this.options={},this.data={},"string"!=typeof n||null==document.getElementById(n))throw new TypeError("First parameter of Nativetable need to be a valid tag ID.");this.options.id=n,this.options.box=document.getElementById(n),this.options.reloading={},this.options.filters=s,this.options.sorting={activated:f},this.options.pagination={currentPage:0,maxLength:c},this.columns=l,this.sources=o,this.draw()}return n(e,[{key:"sources",get:function(){return this.data.sources},set:function(t){this.options.reloading.filtered=!0,this.options.reloading.sorted=!0,this.options.reloading.paginated=!0,this.data.sources=t}},{key:"filters",get:function(){return this.options.filters},set:function(t){this.options.reloading.filtered=!0,this.options.filters=t}},{key:"filtered",get:function(){var t=this.options.filters;if(this.data.filtered&&this.data.filtered.length>0&&this.options.reloading.filtered===!1)return this.data.filtered;if(0===Object.keys(t).length)return this.data.filtered=this.sources,this.options.reloading.filtered=!1,this.data.filtered;var n=function(t){var n=!0,e=!0,i=!1,a=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;n=n&&s}}catch(t){i=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw a}}return n},e=function(t){var n=!1,e=!0,i=!1,a=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;n=n||s}}catch(t){i=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw a}}return n},i=function(t,n){if("function"==typeof n){var i=n,a=i(t);return"boolean"==typeof a&&a}var o=[],r=!0,s=!1,d=void 0;try{for(var l,h=n[Symbol.iterator]();!(r=(l=h.next()).done);r=!0){var u=l.value;o.push(t===u)}}catch(t){s=!0,d=t}finally{try{!r&&h.return&&h.return()}finally{if(s)throw d}}return e(o)};return this.data.filtered=this.sources.filter(function(a){var o=[];if("$and"in t){var r=Object.keys(t.$and),s=t.$and,d=[],l=!0,h=!1,u=void 0;try{for(var c,p=r[Symbol.iterator]();!(l=(c=p.next()).done);l=!0){var f=c.value;d.push(i(a[f],s[f]))}}catch(t){h=!0,u=t}finally{try{!l&&p.return&&p.return()}finally{if(h)throw u}}o.push(n(d))}if("$or"in t){var v=Object.keys(t.$or),g=t.$or,y=[],m=!0,b=!1,x=void 0;try{for(var C,k=v[Symbol.iterator]();!(m=(C=k.next()).done);m=!0){var w=C.value;y.push(i(a[w],g[w]))}}catch(t){b=!0,x=t}finally{try{!m&&k.return&&k.return()}finally{if(b)throw x}}o.push(e(y))}return n(o)}),this.options.reloading.filtered=!1,this.data.filtered}},{key:"sorted",get:function(){if(this.data.sorted&&this.data.sorted.length>0&&this.options.reloading.sorted===!1)return this.data.sorted;var t=this.filtered,n=this.options.sorting,e=n.column,i=n.order,a=void 0===i?"none":i,o=n.activated;if(t.length<=0||o===!1||"undefined"==typeof e)return this.data.sorted=t,this.options.reloading.sorted=!1,this.data.sorted;var r=t.map(function(t,n){var i=t[e];return"string"==typeof t[e]&&(i=t[e].toLowerCase()),"undefined"==typeof t[e]&&(i=""),{index:n,value:i}});return r.sort(function(t,n){return t.value>n.value?"asc"===a?1:-1:t.value<n.value?"asc"===a?-1:1:0}),this.data.sorted=r.map(function(n){return t[n.index]}),this.options.reloading.sorted=!1,this.data.sorted}},{key:"paginated",get:function(){if(this.data.paginated&&this.data.paginated.length>0&&this.options.reloading.paginated===!1)return this.data.paginated;var t=this.sorted,n=this.options.pagination.maxLength;if(t.length<=0)return this.data.paginated=[],this.options.reloading.paginated=!1,this.data.paginated;if(n===-1)return this.data.paginated=[t],this.data.paginated;var e=[],i=[],a=!0,o=!1,r=void 0;try{for(var s,d=t[Symbol.iterator]();!(a=(s=d.next()).done);a=!0){var l=s.value;i.length>=n&&(e.push(i),i=[]),i.push(l)}}catch(t){o=!0,r=t}finally{try{!a&&d.return&&d.return()}finally{if(o)throw r}}return e.push(i),this.data.paginated=e,this.options.reloading.paginated=!1,this.data.paginated}},{key:"columns",get:function(){var t=this.options.columns||[];return t.length>0?t:(this.filtered.forEach(function(n){var e=Object.keys(n),i=!0,a=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var d=r.value;t.indexOf(d)===-1&&t.push(d)}}catch(t){a=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw o}}}),this.options.columns=t,this.options.columns)},set:function(t){if(this.options.columns=[],null!=t){var n=!0,e=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var r=a.value;"string"==typeof r&&this.options.columns.push(r)}}catch(t){e=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(e)throw i}}}}},{key:"pagination",set:function(t){var n=t.maxLength,e=void 0===n?-1:n;this.options.reloading.paginated=!0,this.options.pagination.maxLength=e},get:function(){return{currentPage:this.options.pagination.currentPage,maxLength:this.options.pagination.maxLength}}}]),n(e,[{key:"reload",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.options.pagination.currentPage=0,this.sources=t.length>0?t:this.sources,this.options.reloading.filtered=!0,this.options.reloading.paginated=!0,this.draw()}},{key:"draw",value:function(){var t=this.paginated,n=1!==t.length;if(!(t.length<=0)){var e=this.options.pagination.currentPage;e=e<t.length?e:0;var i=void 0,a=void 0,o=void 0,r=void 0;if(this.options.box.children[1]&&this.options.box.children[1].classList.contains("nt-pagination")&&(r=this.options.box.children[1],this.options.box.removeChild(r)),n&&(r=this.buildPagination(t,e),this.options.box.appendChild(r)),this.options.box.children[0]&&this.options.box.children[0].classList.contains("nt-table"))return i=this.options.box.children[0],a=i.children[0],o=i.children[1],i.removeChild(o),this.options.reloading.headers&&(i.removeChild(a),a=this.buildTableHeader(this.columns),i.appendChild(a)),o=this.buildTableBody(t[e],this.columns),void i.appendChild(o);i=document.createElement("table"),a=this.buildTableHeader(this.columns),o=this.buildTableBody(t[e],this.columns),i.classList.add("nt-table"),i.appendChild(a),i.appendChild(o),this.options.box.insertBefore(i,r)}}},{key:"buildTableHeader",value:function(t){var n=t,e=document.createElement("thead"),i=document.createElement("tr");e.classList.add("nt-head");var a=!0,o=!1,r=void 0;try{for(var s,d=n[Symbol.iterator]();!(a=(s=d.next()).done);a=!0){var l=s.value,h=document.createElement("td");if(h.textContent=l,this.options.sorting.activated){var u={asc:'<span class="nt-icon nt-icon-sort-asc"></span>',desc:'<span class="nt-icon nt-icon-sort-desc"></span>',none:'<span class="nt-icon nt-icon-sort-none"></span>'},c=this.options.sorting.column===l?this.options.sorting.order:"none",p=u[c],f=document.createElement("a");f.href="#",f.addEventListener("click",this.onSortingClick.bind(this)),f.innerHTML=l+" "+p,h.dataset.ntColumnName=l,h.textContent="",h.appendChild(f)}i.appendChild(h)}}catch(t){o=!0,r=t}finally{try{!a&&d.return&&d.return()}finally{if(o)throw r}}return e.appendChild(i),e}},{key:"buildTableBody",value:function(t,n){var e=t,i=n,a=document.createElement("tbody");a.classList.add("nt-body");var o=!0,r=!1,s=void 0;try{for(var d,l=e[Symbol.iterator]();!(o=(d=l.next()).done);o=!0){var h=d.value,u=document.createElement("tr");u.classList.add("nt-row"),u.dataset.ntObject=this.objectSignature(h);var c=!0,p=!1,f=void 0;try{for(var v,g=i[Symbol.iterator]();!(c=(v=g.next()).done);c=!0){var y=v.value,m=document.createElement("td");m.textContent="undefined"==typeof h[y]?"":h[y],u.appendChild(m)}}catch(t){p=!0,f=t}finally{try{!c&&g.return&&g.return()}finally{if(p)throw f}}a.appendChild(u)}}catch(t){r=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return a}},{key:"buildPagination",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=t,i=document.createElement("ul");for(var a in e){var o=document.createElement("li"),r=document.createElement("a");a=+a,r.href="#",r.textContent=a+1,r.addEventListener("click",this.onPaginationClick.bind(this)),o.classList.add("nt-pagination-item"),o.dataset.ntPaginationIndex=a,o.appendChild(r),a===n&&o.classList.add("nt-pagination-item-active"),i.appendChild(o)}return i.classList.add("nt-pagination"),i}},{key:"onPaginationClick",value:function(t){t.preventDefault();var n=t.target.parentNode;this.options.pagination.currentPage=parseInt(n.dataset.ntPaginationIndex),this.draw()}},{key:"onSortingClick",value:function(t){t.preventDefault();var n=t.target.parentNode;this.options.sorting.column!==n.dataset.ntColumnName&&(this.options.sorting.column=n.dataset.ntColumnName,this.options.sorting.order="none"),this.options.sorting.order="asc"===this.options.sorting.order?"desc":"asc",this.options.reloading.sorted=!0,this.options.reloading.headers=!0,this.draw()}},{key:"objectSignature",value:function(t){return btoa(JSON.stringify(t,this.columns))}}]),e}();return e}();
